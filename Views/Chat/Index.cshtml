
<div style="display:grid; grid-template-columns: 65px auto; align-items:center">
    <img src="../favicon.png" style="width:56px">
    <h3>Salle de discussions</h3>
</div>
<hr />
<div style="display: grid; grid-template-columns: 65px auto;">
    <div style="margin: 4px; border: 1px solid lightgray; ">
        <div id="friendList"></div>
    </div>
    <div>
        <div style="margin: 4px; border: 1px solid lightgray; ">
            <div id="chatLog"></div>
        </div>
        <div style="margin: 4px; border: 1px solid lightgray;">
            <div id="writingBar"></div>
        </div>
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/NotificationsHandler")

<script defer>
        let friendListRefresh = new PartialRefresh("@Url.Action("GetFriend")", "friendList", 5, Callback);
        let messageRefresh = new PartialRefresh("@Url.Action("GetFriendsList")", "chatLog", 5, Callback);

        // renew checkbox change call back
        $(".rechercheFriendship").change(UpdateSearch);
        $("#userBlocked").change(UpdateSearch);

        function UpdateSearch() {
            var checkedValue = "";
                var inputElements = document.getElementsByClassName('rechercheFriendship');
                for (var i = 0; inputElements[i]; ++i) {
                    if (inputElements[i].checked) {
                        checkedValue += inputElements[i].value + "_";
                    }
                }
                checkedValue += document.getElementById('userBlocked').checked ? '1' : '0';
                friendshipStatus.command("@Url.Action("UpdateSearch")" + "?recherche=" + checkedValue)
        }
        $(".DELETE_USER").click(
            function () {
                let userid = this.id.split('_')[1];
                friendshipStatus.confirmedCommand(this.title + ' ?', "@Url.Action("Delete")" + "?userid=" + userid);
            }
        );
        // do not use
        $(".SwitchToUser").click(function () {
            window.location = "/Accounts/SwitchToUser/" + $(this).attr("id");
        });
        $('#Search').click(function () {
            friendshipStatus.command("@Url.Action("UpdateNameSearch")" + "?search=" + $('#SearchText').val())
        });
        $('#SearchText').bind("keypress keyup keydown", function () {
            friendshipStatus.command("@Url.Action("UpdateNameSearch")" + "?search=" + $('#SearchText').val())
        });
        function Callback() {
            $(".command").click(function () {
                var url = $(this).attr("url");
                var message = $(this).attr("message");
                friendShipsStatus.confirmedCommand(message, url);
            });
        }
</script>
}

